---
phase: 07-frontend-member-area
plan: 08
type: execute
wave: 3
depends_on: ["07-03"]
files_modified:
  - frontend/src/app/(auth)/cohorts/page.tsx
  - frontend/src/components/member/CohortCard.tsx
autonomous: true

must_haves:
  truths:
    - "Member can view available cohorts"
    - "Member can see cohort schedules"
    - "Cohort status shown (upcoming, open, closed)"
    - "Free users see cohorts but cannot enroll"
  artifacts:
    - path: "frontend/src/app/(auth)/cohorts/page.tsx"
      provides: "Cohorts page with schedule"
      contains: "CohortCard"
    - path: "frontend/src/components/member/CohortCard.tsx"
      provides: "Cohort display card"
      contains: "startDate|endDate|status"
  key_links:
    - from: "frontend/src/app/(auth)/cohorts/page.tsx"
      to: "/cohorts"
      via: "fetchAPI"
      pattern: "fetchAPI.*cohorts"
---

<objective>
Create cohorts page showing available cohorts with schedules, enrollment status, and dates. Members can view and enroll, free users see information but need to upgrade.

Purpose: Members view cohort schedules and enrollment opportunities.
Output: Cohorts page at /cohorts with cohort list and schedule view.
</objective>

<execution_context>
@/Users/dio/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dio/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-frontend-member-area/07-03-PLAN.md (Layout)

# Backend cohort endpoints
@backend/src/routes/cohorts.ts
@backend/src/db/schema/cohorts.ts (status enum)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update types and create cohort components</name>
  <files>
    frontend/src/types/index.ts
    frontend/src/components/member/CohortCard.tsx
  </files>
  <action>
Update `frontend/src/types/index.ts` to add cohort session types (append after existing types):
```typescript
// Add after existing Cohort interface

export interface CohortSession {
  id: number
  cohortId: number
  title: string
  scheduledAt: string
  zoomLink: string | null
  recordingUrl: string | null
  sessionOrder: number
}

export interface CohortWithSessions extends Omit<Cohort, 'title' | 'description'> {
  name: string
  courseId: number
  status: 'upcoming' | 'open' | 'closed' | 'completed'
  enrollmentOpenDate: string
  enrollmentCloseDate: string
  sessions: CohortSession[]
  course?: {
    id: number
    title: string
    slug: string
  }
}
```

Create `frontend/src/components/member/CohortCard.tsx`:
```typescript
import Link from 'next/link'
import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from '@/components/ui/card'
import { Badge } from '@/components/ui/badge'
import { Button } from '@/components/ui/button'
import { Calendar, Clock, Users, MapPin, Lock } from 'lucide-react'
import type { CohortWithSessions } from '@/types'

interface CohortCardProps {
  cohort: CohortWithSessions
  userTier: 'free' | 'member'
}

const statusConfig = {
  upcoming: { label: 'Segera Dibuka', variant: 'secondary' as const },
  open: { label: 'Pendaftaran Dibuka', variant: 'default' as const },
  closed: { label: 'Pendaftaran Ditutup', variant: 'outline' as const },
  completed: { label: 'Selesai', variant: 'outline' as const },
}

export function CohortCard({ cohort, userTier }: CohortCardProps) {
  const status = statusConfig[cohort.status] || statusConfig.upcoming
  const isPaid = cohort.price && cohort.price > 0
  const canEnroll = cohort.status === 'open' && userTier === 'member'
  const spotsLeft = cohort.maxParticipants
    ? cohort.maxParticipants - cohort.enrolledCount
    : null

  const formatDate = (date: string) => {
    return new Date(date).toLocaleDateString('id-ID', {
      day: 'numeric',
      month: 'short',
      year: 'numeric',
    })
  }

  const formatTime = (date: string) => {
    return new Date(date).toLocaleTimeString('id-ID', {
      hour: '2-digit',
      minute: '2-digit',
    })
  }

  return (
    <Card className="h-full flex flex-col">
      <CardHeader>
        <div className="flex items-start justify-between gap-2">
          <div className="space-y-1">
            <CardTitle className="text-lg">{cohort.name}</CardTitle>
            {cohort.course && (
              <CardDescription>{cohort.course.title}</CardDescription>
            )}
          </div>
          <Badge variant={status.variant}>{status.label}</Badge>
        </div>
      </CardHeader>

      <CardContent className="flex-1 space-y-4">
        {/* Schedule Info */}
        <div className="space-y-2 text-sm">
          <div className="flex items-center gap-2 text-muted-foreground">
            <Calendar className="h-4 w-4" />
            <span>
              {formatDate(cohort.startDate)} - {formatDate(cohort.endDate)}
            </span>
          </div>

          {spotsLeft !== null && (
            <div className="flex items-center gap-2 text-muted-foreground">
              <Users className="h-4 w-4" />
              <span>
                {spotsLeft > 0
                  ? `${spotsLeft} tempat tersisa`
                  : 'Kuota penuh'}
              </span>
            </div>
          )}

          {isPaid && (
            <div className="flex items-center gap-2 text-muted-foreground">
              <span className="font-medium text-foreground">
                Rp {cohort.price?.toLocaleString('id-ID')}
              </span>
            </div>
          )}
        </div>

        {/* Sessions Preview */}
        {cohort.sessions && cohort.sessions.length > 0 && (
          <div className="space-y-2">
            <p className="text-sm font-medium">
              {cohort.sessions.length} Sesi:
            </p>
            <div className="space-y-1">
              {cohort.sessions
                .slice(0, 3)
                .sort((a, b) => a.sessionOrder - b.sessionOrder)
                .map((session) => (
                  <div
                    key={session.id}
                    className="text-xs text-muted-foreground flex items-center gap-2"
                  >
                    <Clock className="h-3 w-3" />
                    <span>
                      {formatDate(session.scheduledAt)} {formatTime(session.scheduledAt)}
                    </span>
                    <span className="truncate">- {session.title}</span>
                  </div>
                ))}
              {cohort.sessions.length > 3 && (
                <p className="text-xs text-muted-foreground">
                  +{cohort.sessions.length - 3} sesi lainnya
                </p>
              )}
            </div>
          </div>
        )}
      </CardContent>

      <CardFooter>
        {canEnroll ? (
          <Button className="w-full" asChild>
            <Link href={`/pricing`}>
              {isPaid ? 'Daftar & Bayar' : 'Daftar Sekarang'}
            </Link>
          </Button>
        ) : userTier === 'free' ? (
          <Button variant="outline" className="w-full" asChild>
            <Link href="/pricing">
              <Lock className="h-4 w-4 mr-2" />
              Upgrade untuk Daftar
            </Link>
          </Button>
        ) : cohort.status === 'upcoming' ? (
          <Button variant="outline" className="w-full" disabled>
            <Clock className="h-4 w-4 mr-2" />
            Segera Dibuka
          </Button>
        ) : cohort.status === 'closed' || spotsLeft === 0 ? (
          <Button variant="outline" className="w-full" disabled>
            Pendaftaran Ditutup
          </Button>
        ) : (
          <Button variant="outline" className="w-full" disabled>
            Selesai
          </Button>
        )}
      </CardFooter>
    </Card>
  )
}
```
  </action>
  <verify>
Check `frontend/src/types/index.ts` includes CohortSession and CohortWithSessions types.
Check `frontend/src/components/member/CohortCard.tsx` exists.

TypeScript should compile: `cd frontend && npx tsc --noEmit`
  </verify>
  <done>Cohort types and CohortCard component created with status handling, schedule display, and tier-aware actions.</done>
</task>

<task type="auto">
  <name>Task 2: Create cohorts page</name>
  <files>
    frontend/src/app/(auth)/cohorts/page.tsx
  </files>
  <action>
Create directory `frontend/src/app/(auth)/cohorts/`.

Create `frontend/src/app/(auth)/cohorts/page.tsx`:
```typescript
import { Metadata } from 'next'
import Link from 'next/link'
import { getUser } from '@/lib/auth/dal'
import { fetchAPI } from '@/lib/api-client'
import { redirect } from 'next/navigation'
import { EmptyState } from '@/components/member/EmptyState'
import { CohortCard } from '@/components/member/CohortCard'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { SITE_NAME } from '@/lib/constants'
import type { CohortWithSessions } from '@/types'
import { Calendar, ArrowRight } from 'lucide-react'

export const metadata: Metadata = {
  title: `Jadwal Kohort - ${SITE_NAME}`,
  description: 'Lihat jadwal dan daftar kohort kursus.',
}

export default async function CohortsPage() {
  const user = await getUser()

  if (!user) {
    redirect('/login')
  }

  let cohorts: CohortWithSessions[] = []

  try {
    const data = await fetchAPI<{ cohorts: CohortWithSessions[] }>('/cohorts', {
      revalidate: 300,
    })
    cohorts = data.cohorts || []
  } catch {
    cohorts = []
  }

  // Group cohorts by status
  const openCohorts = cohorts.filter(c => c.status === 'open')
  const upcomingCohorts = cohorts.filter(c => c.status === 'upcoming')
  const pastCohorts = cohorts.filter(c => c.status === 'closed' || c.status === 'completed')

  if (cohorts.length === 0) {
    return (
      <div className="space-y-6">
        <div>
          <h1 className="text-3xl font-bold tracking-tight">Jadwal Kohort</h1>
          <p className="text-muted-foreground">Jadwal kelas dan sesi live</p>
        </div>
        <EmptyState
          icon={<Calendar className="h-12 w-12 text-muted-foreground" />}
          title="Belum Ada Jadwal Kohort"
          description="Kohort baru akan segera dibuka. Pantau terus untuk update terbaru."
        />
      </div>
    )
  }

  return (
    <div className="space-y-8">
      <div>
        <h1 className="text-3xl font-bold tracking-tight">Jadwal Kohort</h1>
        <p className="text-muted-foreground">
          {user.tier === 'member'
            ? 'Daftar dan ikuti kelas live bersama instruktur'
            : 'Upgrade ke member untuk ikuti kelas live'}
        </p>
      </div>

      {/* Open Cohorts */}
      {openCohorts.length > 0 && (
        <section className="space-y-4">
          <h2 className="text-xl font-semibold">Pendaftaran Dibuka</h2>
          <div className="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
            {openCohorts.map((cohort) => (
              <CohortCard key={cohort.id} cohort={cohort} userTier={user.tier} />
            ))}
          </div>
        </section>
      )}

      {/* Upcoming Cohorts */}
      {upcomingCohorts.length > 0 && (
        <section className="space-y-4">
          <h2 className="text-xl font-semibold">Segera Dibuka</h2>
          <div className="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
            {upcomingCohorts.map((cohort) => (
              <CohortCard key={cohort.id} cohort={cohort} userTier={user.tier} />
            ))}
          </div>
        </section>
      )}

      {/* Past Cohorts */}
      {pastCohorts.length > 0 && (
        <section className="space-y-4">
          <h2 className="text-xl font-semibold text-muted-foreground">Kohort Sebelumnya</h2>
          <div className="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
            {pastCohorts.slice(0, 6).map((cohort) => (
              <CohortCard key={cohort.id} cohort={cohort} userTier={user.tier} />
            ))}
          </div>
        </section>
      )}

      {/* Upgrade CTA for Free Users */}
      {user.tier === 'free' && (
        <Card className="bg-primary/5 border-primary/20">
          <CardHeader>
            <CardTitle>Ikuti Kelas Live</CardTitle>
            <CardDescription>
              Upgrade ke member untuk mendaftar kohort dan belajar langsung bersama instruktur.
            </CardDescription>
          </CardHeader>
          <CardContent>
            <Button asChild>
              <Link href="/pricing">
                Lihat Harga Membership
                <ArrowRight className="ml-2 h-4 w-4" />
              </Link>
            </Button>
          </CardContent>
        </Card>
      )}
    </div>
  )
}
```
  </action>
  <verify>
Check file exists: `frontend/src/app/(auth)/cohorts/page.tsx`

TypeScript should compile: `cd frontend && npx tsc --noEmit`
Build should succeed: `cd frontend && npm run build`
  </verify>
  <done>Cohorts page created with status-grouped sections, CohortCard display, and upgrade CTA for free users.</done>
</task>

</tasks>

<verification>
Run all verification commands:

```bash
cd frontend

# Check TypeScript compiles
npx tsc --noEmit

# Check build succeeds
npm run build

# Verify file structure
ls -la src/app/\(auth\)/cohorts/
ls -la src/components/member/
```

All should pass without errors.
</verification>

<success_criteria>
1. CohortWithSessions and CohortSession types added
2. CohortCard shows status badge, dates, sessions preview, spots left
3. Cohorts page groups by status (open, upcoming, past)
4. Members see enroll buttons for open cohorts
5. Free users see upgrade prompts
6. Session schedules displayed with times
7. TypeScript compiles without errors
8. Build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/07-frontend-member-area/07-08-SUMMARY.md`
</output>
