---
phase: 07-frontend-member-area
plan: 03
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - frontend/src/app/(auth)/layout.tsx
  - frontend/src/components/member/Sidebar.tsx
  - frontend/src/components/member/LogoutButton.tsx
  - frontend/src/components/member/EmptyState.tsx
autonomous: true

must_haves:
  truths:
    - "Member area has sidebar navigation"
    - "Sidebar shows user info and navigation links"
    - "User can log out from sidebar"
    - "Layout persists across member pages"
  artifacts:
    - path: "frontend/src/app/(auth)/layout.tsx"
      provides: "Member area layout with sidebar"
      contains: "Sidebar"
    - path: "frontend/src/components/member/Sidebar.tsx"
      provides: "Navigation sidebar for member pages"
      contains: "Dashboard|Kursus|Riset|Download|Jadwal|Profil"
    - path: "frontend/src/components/member/LogoutButton.tsx"
      provides: "Client component for logout"
      contains: "use client"
  key_links:
    - from: "frontend/src/app/(auth)/layout.tsx"
      to: "frontend/src/lib/auth/dal.ts"
      via: "requireAuth call"
      pattern: "requireAuth"
    - from: "frontend/src/components/member/LogoutButton.tsx"
      to: "/auth/logout"
      via: "fetch POST"
      pattern: "fetch.*auth/logout"
---

<objective>
Create the member area layout with sidebar navigation that persists across all authenticated pages. Layout uses route group (auth) pattern and verifies authentication at layout level.

Purpose: Consistent navigation experience across all member pages with sidebar for quick access.
Output: (auth) route group with layout containing sidebar, logout button, and empty state component for reuse.
</objective>

<execution_context>
@/Users/dio/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dio/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-frontend-member-area/07-01-PLAN.md (DAL, API client)

# Frontend patterns
@frontend/src/components/ui/button.tsx
@frontend/src/components/ui/separator.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create member components (Sidebar, LogoutButton, EmptyState)</name>
  <files>
    frontend/src/components/member/Sidebar.tsx
    frontend/src/components/member/LogoutButton.tsx
    frontend/src/components/member/EmptyState.tsx
  </files>
  <action>
Create `frontend/src/components/member/` directory.

Create `frontend/src/components/member/LogoutButton.tsx`:
```typescript
'use client'

import { useState } from 'react'
import { useRouter } from 'next/navigation'
import { Button } from '@/components/ui/button'
import { LogOut } from 'lucide-react'

const API_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3000'

export function LogoutButton() {
  const [loading, setLoading] = useState(false)
  const router = useRouter()

  const handleLogout = async () => {
    setLoading(true)
    try {
      await fetch(`${API_URL}/auth/logout`, {
        method: 'POST',
        credentials: 'include',
      })
    } catch {
      // Ignore errors, still redirect
    } finally {
      router.push('/login')
      router.refresh()
    }
  }

  return (
    <Button
      variant="ghost"
      size="sm"
      onClick={handleLogout}
      disabled={loading}
      className="w-full justify-start text-muted-foreground hover:text-foreground"
    >
      <LogOut className="mr-2 h-4 w-4" />
      {loading ? 'Keluar...' : 'Keluar'}
    </Button>
  )
}
```

Create `frontend/src/components/member/Sidebar.tsx`:
```typescript
import Link from 'next/link'
import { usePathname } from 'next/navigation'
import {
  LayoutDashboard,
  BookOpen,
  FileText,
  Download,
  Calendar,
  User,
} from 'lucide-react'
import { cn } from '@/lib/utils'
import { Separator } from '@/components/ui/separator'
import { LogoutButton } from './LogoutButton'
import type { User as UserType } from '@/types/auth'

interface SidebarProps {
  user: UserType
}

const navigation = [
  { name: 'Dashboard', href: '/dashboard', icon: LayoutDashboard },
  { name: 'Kursus', href: '/courses', icon: BookOpen },
  { name: 'Riset', href: '/research', icon: FileText },
  { name: 'Download', href: '/downloads', icon: Download },
  { name: 'Jadwal', href: '/cohorts', icon: Calendar },
  { name: 'Profil', href: '/profile', icon: User },
]

export function Sidebar({ user }: SidebarProps) {
  return (
    <SidebarClient user={user} />
  )
}

// Client component for pathname access
function SidebarClient({ user }: SidebarProps) {
  'use client'

  return (
    <aside className="w-64 border-r bg-muted/30 flex flex-col">
      {/* User Info */}
      <div className="p-6">
        <div className="flex items-center gap-3">
          <div className="h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center">
            <span className="text-sm font-medium text-primary">
              {user.name.charAt(0).toUpperCase()}
            </span>
          </div>
          <div className="flex-1 min-w-0">
            <p className="text-sm font-medium truncate">{user.name}</p>
            <p className="text-xs text-muted-foreground truncate">{user.email}</p>
          </div>
        </div>
        <div className="mt-2">
          <span className={cn(
            "inline-flex items-center px-2 py-0.5 rounded text-xs font-medium",
            user.tier === 'member'
              ? "bg-primary/10 text-primary"
              : "bg-muted text-muted-foreground"
          )}>
            {user.tier === 'member' ? 'Member' : 'Free'}
          </span>
        </div>
      </div>

      <Separator />

      {/* Navigation */}
      <nav className="flex-1 p-4">
        <ul className="space-y-1">
          <SidebarNavItems />
        </ul>
      </nav>

      <Separator />

      {/* Logout */}
      <div className="p-4">
        <LogoutButton />
      </div>
    </aside>
  )
}

// Separate client component for pathname
function SidebarNavItems() {
  'use client'
  const pathname = typeof window !== 'undefined' ? window.location.pathname : ''

  // This will be hydrated client-side
  return (
    <>
      {navigation.map((item) => {
        const isActive = pathname.startsWith(item.href)
        return (
          <li key={item.name}>
            <Link
              href={item.href}
              className={cn(
                "flex items-center gap-3 px-3 py-2 rounded-md text-sm transition-colors",
                isActive
                  ? "bg-primary/10 text-primary font-medium"
                  : "text-muted-foreground hover:bg-muted hover:text-foreground"
              )}
            >
              <item.icon className="h-4 w-4" />
              {item.name}
            </Link>
          </li>
        )
      })}
    </>
  )
}
```

Wait, the Sidebar needs to be a proper client component to use usePathname. Let me fix that.

Create `frontend/src/components/member/Sidebar.tsx` (corrected):
```typescript
'use client'

import Link from 'next/link'
import { usePathname } from 'next/navigation'
import {
  LayoutDashboard,
  BookOpen,
  FileText,
  Download,
  Calendar,
  User,
} from 'lucide-react'
import { cn } from '@/lib/utils'
import { Separator } from '@/components/ui/separator'
import { LogoutButton } from './LogoutButton'
import type { User as UserType } from '@/types/auth'

interface SidebarProps {
  user: UserType
}

const navigation = [
  { name: 'Dashboard', href: '/dashboard', icon: LayoutDashboard },
  { name: 'Kursus', href: '/courses', icon: BookOpen },
  { name: 'Riset', href: '/research', icon: FileText },
  { name: 'Download', href: '/downloads', icon: Download },
  { name: 'Jadwal', href: '/cohorts', icon: Calendar },
  { name: 'Profil', href: '/profile', icon: User },
]

export function Sidebar({ user }: SidebarProps) {
  const pathname = usePathname()

  return (
    <aside className="w-64 border-r bg-muted/30 flex flex-col h-screen sticky top-0">
      {/* User Info */}
      <div className="p-6">
        <div className="flex items-center gap-3">
          <div className="h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center">
            <span className="text-sm font-medium text-primary">
              {user.name.charAt(0).toUpperCase()}
            </span>
          </div>
          <div className="flex-1 min-w-0">
            <p className="text-sm font-medium truncate">{user.name}</p>
            <p className="text-xs text-muted-foreground truncate">{user.email}</p>
          </div>
        </div>
        <div className="mt-2">
          <span className={cn(
            "inline-flex items-center px-2 py-0.5 rounded text-xs font-medium",
            user.tier === 'member'
              ? "bg-primary/10 text-primary"
              : "bg-muted text-muted-foreground"
          )}>
            {user.tier === 'member' ? 'Member' : 'Free'}
          </span>
        </div>
      </div>

      <Separator />

      {/* Navigation */}
      <nav className="flex-1 p-4 overflow-y-auto">
        <ul className="space-y-1">
          {navigation.map((item) => {
            const isActive = pathname.startsWith(item.href)
            return (
              <li key={item.name}>
                <Link
                  href={item.href}
                  className={cn(
                    "flex items-center gap-3 px-3 py-2 rounded-md text-sm transition-colors",
                    isActive
                      ? "bg-primary/10 text-primary font-medium"
                      : "text-muted-foreground hover:bg-muted hover:text-foreground"
                  )}
                >
                  <item.icon className="h-4 w-4" />
                  {item.name}
                </Link>
              </li>
            )
          })}
        </ul>
      </nav>

      <Separator />

      {/* Logout */}
      <div className="p-4">
        <LogoutButton />
      </div>
    </aside>
  )
}
```

Create `frontend/src/components/member/EmptyState.tsx`:
```typescript
import { Button } from '@/components/ui/button'
import { BookOpen, ArrowRight } from 'lucide-react'
import Link from 'next/link'
import { ReactNode } from 'react'

interface EmptyStateProps {
  title: string
  description: string
  actionLabel?: string
  actionHref?: string
  icon?: ReactNode
}

export function EmptyState({
  title,
  description,
  actionLabel,
  actionHref,
  icon,
}: EmptyStateProps) {
  return (
    <div className="flex flex-col items-center justify-center py-12 text-center">
      <div className="mb-4 rounded-full bg-muted p-6">
        {icon || <BookOpen className="h-12 w-12 text-muted-foreground" />}
      </div>
      <h3 className="mb-2 text-xl font-semibold">{title}</h3>
      <p className="mb-6 max-w-md text-muted-foreground">{description}</p>
      {actionLabel && actionHref && (
        <Button asChild>
          <Link href={actionHref}>
            {actionLabel}
            <ArrowRight className="ml-2 h-4 w-4" />
          </Link>
        </Button>
      )}
    </div>
  )
}
```
  </action>
  <verify>
Check files exist:
- `frontend/src/components/member/Sidebar.tsx`
- `frontend/src/components/member/LogoutButton.tsx`
- `frontend/src/components/member/EmptyState.tsx`

TypeScript should compile: `cd frontend && npx tsc --noEmit`
  </verify>
  <done>Member components created: Sidebar with navigation and user info, LogoutButton with API call, EmptyState for empty content areas.</done>
</task>

<task type="auto">
  <name>Task 2: Create (auth) route group layout</name>
  <files>
    frontend/src/app/(auth)/layout.tsx
  </files>
  <action>
Create directory `frontend/src/app/(auth)/`.

Create `frontend/src/app/(auth)/layout.tsx`:
```typescript
import { redirect } from 'next/navigation'
import { getUser } from '@/lib/auth/dal'
import { Sidebar } from '@/components/member/Sidebar'

export default async function MemberLayout({
  children,
}: {
  children: React.ReactNode
}) {
  const user = await getUser()

  if (!user) {
    redirect('/login')
  }

  return (
    <div className="flex min-h-screen">
      <Sidebar user={user} />
      <main className="flex-1 overflow-y-auto">
        <div className="container py-8">
          {children}
        </div>
      </main>
    </div>
  )
}
```

This layout:
1. Uses getUser() from DAL to verify auth and get user data
2. Redirects to login if not authenticated
3. Renders Sidebar with user info
4. Provides consistent container for page content
5. Uses route group (auth) so URL doesn't include "auth" prefix
  </action>
  <verify>
Check file exists: `frontend/src/app/(auth)/layout.tsx`

TypeScript should compile: `cd frontend && npx tsc --noEmit`
Build should succeed: `cd frontend && npm run build`
  </verify>
  <done>Member layout created with sidebar and auth verification at layout level.</done>
</task>

</tasks>

<verification>
Run all verification commands:

```bash
cd frontend

# Check TypeScript compiles
npx tsc --noEmit

# Check build succeeds
npm run build

# Verify file structure
ls -la src/app/\(auth\)/
ls -la src/components/member/
```

All should pass without errors.
</verification>

<success_criteria>
1. Sidebar component with navigation links (Dashboard, Kursus, Riset, Download, Jadwal, Profil)
2. Sidebar shows user name, email, tier badge
3. LogoutButton client component with API call
4. EmptyState component for reuse across pages
5. (auth) route group layout verifies auth and renders sidebar
6. TypeScript compiles without errors
7. Build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/07-frontend-member-area/07-03-SUMMARY.md`
</output>
