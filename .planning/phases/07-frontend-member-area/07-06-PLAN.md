---
phase: 07-frontend-member-area
plan: 06
type: execute
wave: 3
depends_on: ["07-03"]
files_modified:
  - frontend/src/app/(auth)/research/page.tsx
  - frontend/src/app/(auth)/research/[slug]/page.tsx
  - frontend/src/components/member/ResearchDetailCard.tsx
autonomous: true

must_haves:
  truths:
    - "Member can view all research reports"
    - "Member can read full research content"
    - "Free users see preview reports only"
    - "Research detail shows stock info and analyst rating"
  artifacts:
    - path: "frontend/src/app/(auth)/research/page.tsx"
      provides: "Research library page"
      contains: "ResearchCard"
    - path: "frontend/src/app/(auth)/research/[slug]/page.tsx"
      provides: "Research detail page with full content"
      contains: "content"
  key_links:
    - from: "frontend/src/app/(auth)/research/[slug]/page.tsx"
      to: "/research/{slug}"
      via: "fetchAPI"
      pattern: "fetchAPI.*research"
---

<objective>
Create research library page with full member access and detail page for reading complete reports. Members see all reports, free users see only free preview reports.

Purpose: Members access research reports with full content and stock analysis data.
Output: Research pages at /research and /research/[slug]
</objective>

<execution_context>
@/Users/dio/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dio/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-frontend-member-area/07-03-PLAN.md (Layout)

# Existing research components
@frontend/src/components/shared/ResearchCard.tsx (from 06-04)

# Backend research endpoints
@backend/src/routes/research.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create research library and detail pages</name>
  <files>
    frontend/src/app/(auth)/research/page.tsx
    frontend/src/app/(auth)/research/[slug]/page.tsx
    frontend/src/components/member/ResearchDetailCard.tsx
  </files>
  <action>
Create directory structure:
- `frontend/src/app/(auth)/research/`
- `frontend/src/app/(auth)/research/[slug]/`

Create `frontend/src/components/member/ResearchDetailCard.tsx`:
```typescript
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { Badge } from '@/components/ui/badge'
import { TrendingUp, TrendingDown, Target } from 'lucide-react'

interface ResearchDetailCardProps {
  stockSymbol: string | null
  stockName: string | null
  analystRating: string | null
  targetPrice: number | null
}

export function ResearchDetailCard({
  stockSymbol,
  stockName,
  analystRating,
  targetPrice,
}: ResearchDetailCardProps) {
  if (!stockSymbol && !analystRating && !targetPrice) {
    return null
  }

  const getRatingColor = (rating: string | null) => {
    if (!rating) return 'secondary'
    const lower = rating.toLowerCase()
    if (lower.includes('buy') || lower.includes('strong')) return 'default'
    if (lower.includes('hold') || lower.includes('neutral')) return 'secondary'
    if (lower.includes('sell') || lower.includes('underperform')) return 'destructive'
    return 'secondary'
  }

  const getRatingIcon = (rating: string | null) => {
    if (!rating) return null
    const lower = rating.toLowerCase()
    if (lower.includes('buy') || lower.includes('strong')) return <TrendingUp className="h-4 w-4" />
    if (lower.includes('sell') || lower.includes('underperform')) return <TrendingDown className="h-4 w-4" />
    return null
  }

  return (
    <Card>
      <CardHeader>
        <CardTitle className="text-base">Informasi Saham</CardTitle>
      </CardHeader>
      <CardContent className="space-y-4">
        {stockSymbol && (
          <div className="flex justify-between items-center">
            <span className="text-sm text-muted-foreground">Simbol</span>
            <span className="font-mono font-medium">{stockSymbol}</span>
          </div>
        )}
        {stockName && (
          <div className="flex justify-between items-center">
            <span className="text-sm text-muted-foreground">Nama</span>
            <span className="font-medium">{stockName}</span>
          </div>
        )}
        {analystRating && (
          <div className="flex justify-between items-center">
            <span className="text-sm text-muted-foreground">Rating</span>
            <Badge variant={getRatingColor(analystRating)} className="flex items-center gap-1">
              {getRatingIcon(analystRating)}
              {analystRating}
            </Badge>
          </div>
        )}
        {targetPrice && (
          <div className="flex justify-between items-center">
            <span className="text-sm text-muted-foreground">Target Harga</span>
            <span className="font-medium flex items-center gap-1">
              <Target className="h-4 w-4 text-muted-foreground" />
              Rp {targetPrice.toLocaleString('id-ID')}
            </span>
          </div>
        )}
      </CardContent>
    </Card>
  )
}
```

Create `frontend/src/app/(auth)/research/page.tsx`:
```typescript
import { Metadata } from 'next'
import Link from 'next/link'
import { getUser } from '@/lib/auth/dal'
import { fetchAPI } from '@/lib/api-client'
import { redirect } from 'next/navigation'
import { EmptyState } from '@/components/member/EmptyState'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Badge } from '@/components/ui/badge'
import { Button } from '@/components/ui/button'
import { SITE_NAME } from '@/lib/constants'
import type { ResearchReport } from '@/types'
import { FileText, Lock, ArrowRight } from 'lucide-react'

export const metadata: Metadata = {
  title: `Riset - ${SITE_NAME}`,
  description: 'Akses laporan riset dan analisis saham.',
}

export default async function ResearchPage() {
  const user = await getUser()

  if (!user) {
    redirect('/login')
  }

  let reports: ResearchReport[] = []

  try {
    const data = await fetchAPI<{ reports: ResearchReport[] }>('/research', {
      revalidate: 300,
    })
    reports = data.reports || []
  } catch {
    reports = []
  }

  // Filter based on user tier
  const accessibleReports = reports.filter(
    report => user.tier === 'member' || report.requiredTier === 'free'
  )
  const lockedReports = reports.filter(
    report => user.tier === 'free' && report.requiredTier === 'member'
  )

  if (reports.length === 0) {
    return (
      <div className="space-y-6">
        <div>
          <h1 className="text-3xl font-bold tracking-tight">Riset</h1>
          <p className="text-muted-foreground">Laporan analisis saham</p>
        </div>
        <EmptyState
          icon={<FileText className="h-12 w-12 text-muted-foreground" />}
          title="Belum Ada Laporan Riset"
          description="Laporan riset akan segera tersedia. Pantau terus untuk update terbaru."
        />
      </div>
    )
  }

  return (
    <div className="space-y-6">
      <div>
        <h1 className="text-3xl font-bold tracking-tight">Riset</h1>
        <p className="text-muted-foreground">
          {user.tier === 'member'
            ? 'Akses semua laporan riset dan analisis saham'
            : 'Upgrade untuk akses ke semua laporan riset'}
        </p>
      </div>

      {/* Accessible Reports */}
      {accessibleReports.length > 0 && (
        <div className="space-y-4">
          <h2 className="text-lg font-semibold">
            {user.tier === 'member' ? 'Semua Laporan' : 'Laporan Gratis'}
          </h2>
          <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
            {accessibleReports.map((report) => (
              <Link key={report.id} href={`/research/${report.slug}`}>
                <Card className="h-full hover:bg-muted/50 transition-colors">
                  <CardHeader>
                    <div className="flex items-start justify-between gap-2">
                      <CardTitle className="text-lg line-clamp-2">{report.title}</CardTitle>
                      <Badge variant={report.requiredTier === 'free' ? 'secondary' : 'default'}>
                        {report.requiredTier === 'free' ? 'Free' : 'Member'}
                      </Badge>
                    </div>
                  </CardHeader>
                  <CardContent>
                    <CardDescription className="line-clamp-3">{report.summary}</CardDescription>
                    {report.publishedAt && (
                      <p className="text-xs text-muted-foreground mt-4">
                        {new Date(report.publishedAt).toLocaleDateString('id-ID', {
                          day: 'numeric',
                          month: 'long',
                          year: 'numeric',
                        })}
                      </p>
                    )}
                  </CardContent>
                </Card>
              </Link>
            ))}
          </div>
        </div>
      )}

      {/* Locked Reports for Free Users */}
      {user.tier === 'free' && lockedReports.length > 0 && (
        <div className="space-y-4">
          <h2 className="text-lg font-semibold">Laporan Member</h2>
          <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
            {lockedReports.map((report) => (
              <Card key={report.id} className="h-full opacity-75">
                <CardHeader>
                  <div className="flex items-start justify-between gap-2">
                    <CardTitle className="text-lg line-clamp-2">{report.title}</CardTitle>
                    <Lock className="h-4 w-4 text-muted-foreground flex-shrink-0" />
                  </div>
                </CardHeader>
                <CardContent>
                  <CardDescription className="line-clamp-3">{report.summary}</CardDescription>
                  <Button variant="outline" size="sm" className="mt-4" asChild>
                    <Link href="/pricing">Unlock</Link>
                  </Button>
                </CardContent>
              </Card>
            ))}
          </div>

          {/* Upgrade CTA */}
          <Card className="bg-primary/5 border-primary/20">
            <CardHeader>
              <CardTitle>Akses Semua Laporan Riset</CardTitle>
              <CardDescription>
                Upgrade ke member untuk membaca {lockedReports.length} laporan riset premium.
              </CardDescription>
            </CardHeader>
            <CardContent>
              <Button asChild>
                <Link href="/pricing">
                  Lihat Harga
                  <ArrowRight className="ml-2 h-4 w-4" />
                </Link>
              </Button>
            </CardContent>
          </Card>
        </div>
      )}
    </div>
  )
}
```

Create `frontend/src/app/(auth)/research/[slug]/page.tsx`:
```typescript
import { Metadata } from 'next'
import Link from 'next/link'
import { notFound, redirect } from 'next/navigation'
import { getUser } from '@/lib/auth/dal'
import { fetchAPI } from '@/lib/api-client'
import { Button } from '@/components/ui/button'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Badge } from '@/components/ui/badge'
import { ResearchDetailCard } from '@/components/member/ResearchDetailCard'
import { SITE_NAME } from '@/lib/constants'
import type { ResearchReportDetail } from '@/types'
import { ArrowLeft, Calendar, Lock } from 'lucide-react'

interface PageProps {
  params: Promise<{ slug: string }>
}

export async function generateMetadata({ params }: PageProps): Promise<Metadata> {
  const { slug } = await params
  try {
    const data = await fetchAPI<{ report: ResearchReportDetail }>(`/research/${slug}`)
    return {
      title: `${data.report.title} - ${SITE_NAME}`,
      description: data.report.summary,
    }
  } catch {
    return {
      title: `Riset - ${SITE_NAME}`,
    }
  }
}

export default async function ResearchDetailPage({ params }: PageProps) {
  const { slug } = await params
  const user = await getUser()

  if (!user) {
    redirect('/login')
  }

  let report: ResearchReportDetail | null = null

  try {
    const data = await fetchAPI<{ report: ResearchReportDetail }>(`/research/${slug}`, {
      revalidate: 300,
    })
    report = data.report
  } catch (error: any) {
    if (error.status === 403) {
      // Show locked state instead of redirect for better UX
      return (
        <div className="space-y-6">
          <Link
            href="/research"
            className="inline-flex items-center text-sm text-muted-foreground hover:text-foreground"
          >
            <ArrowLeft className="h-4 w-4 mr-2" />
            Kembali ke Riset
          </Link>

          <Card className="text-center py-12">
            <CardContent className="space-y-4">
              <Lock className="h-12 w-12 mx-auto text-muted-foreground" />
              <h2 className="text-xl font-semibold">Konten Premium</h2>
              <p className="text-muted-foreground max-w-md mx-auto">
                Laporan ini hanya tersedia untuk member. Upgrade untuk membaca laporan lengkap.
              </p>
              <Button asChild>
                <Link href="/pricing">Upgrade ke Member</Link>
              </Button>
            </CardContent>
          </Card>
        </div>
      )
    }
    if (error.status === 404) {
      notFound()
    }
    throw error
  }

  if (!report) {
    notFound()
  }

  const canAccess = user.tier === 'member' || report.requiredTier === 'free'

  if (!canAccess) {
    return (
      <div className="space-y-6">
        <Link
          href="/research"
          className="inline-flex items-center text-sm text-muted-foreground hover:text-foreground"
        >
          <ArrowLeft className="h-4 w-4 mr-2" />
          Kembali ke Riset
        </Link>

        <Card className="text-center py-12">
          <CardContent className="space-y-4">
            <Lock className="h-12 w-12 mx-auto text-muted-foreground" />
            <h2 className="text-xl font-semibold">Konten Premium</h2>
            <p className="text-muted-foreground max-w-md mx-auto">
              Laporan ini hanya tersedia untuk member. Upgrade untuk membaca laporan lengkap.
            </p>
            <Button asChild>
              <Link href="/pricing">Upgrade ke Member</Link>
            </Button>
          </CardContent>
        </Card>
      </div>
    )
  }

  return (
    <div className="space-y-6">
      {/* Back Link */}
      <Link
        href="/research"
        className="inline-flex items-center text-sm text-muted-foreground hover:text-foreground"
      >
        <ArrowLeft className="h-4 w-4 mr-2" />
        Kembali ke Riset
      </Link>

      {/* Header */}
      <div className="space-y-4">
        <div className="flex items-start gap-3">
          <h1 className="text-3xl font-bold tracking-tight">{report.title}</h1>
          <Badge variant={report.requiredTier === 'free' ? 'secondary' : 'default'}>
            {report.requiredTier === 'free' ? 'Free' : 'Member'}
          </Badge>
        </div>
        <p className="text-lg text-muted-foreground">{report.summary}</p>
        {report.publishedAt && (
          <p className="text-sm text-muted-foreground flex items-center gap-2">
            <Calendar className="h-4 w-4" />
            {new Date(report.publishedAt).toLocaleDateString('id-ID', {
              day: 'numeric',
              month: 'long',
              year: 'numeric',
            })}
          </p>
        )}
      </div>

      <div className="grid gap-6 lg:grid-cols-3">
        {/* Main Content */}
        <div className="lg:col-span-2">
          <Card>
            <CardContent className="pt-6">
              {report.content ? (
                <div
                  className="prose prose-neutral dark:prose-invert max-w-none"
                  dangerouslySetInnerHTML={{ __html: report.content }}
                />
              ) : (
                <p className="text-muted-foreground text-center py-8">
                  Konten laporan akan segera tersedia.
                </p>
              )}
            </CardContent>
          </Card>
        </div>

        {/* Sidebar */}
        <div className="space-y-4">
          <ResearchDetailCard
            stockSymbol={report.stockSymbol}
            stockName={report.stockName}
            analystRating={report.analystRating}
            targetPrice={report.targetPrice}
          />
        </div>
      </div>
    </div>
  )
}
```
  </action>
  <verify>
Check files exist:
- `frontend/src/app/(auth)/research/page.tsx`
- `frontend/src/app/(auth)/research/[slug]/page.tsx`
- `frontend/src/components/member/ResearchDetailCard.tsx`

TypeScript should compile: `cd frontend && npx tsc --noEmit`
Build should succeed: `cd frontend && npm run build`
  </verify>
  <done>Research pages created: library page with tier-filtered reports, detail page with full content and stock info sidebar.</done>
</task>

</tasks>

<verification>
Run all verification commands:

```bash
cd frontend

# Check TypeScript compiles
npx tsc --noEmit

# Check build succeeds
npm run build

# Verify file structure
ls -la src/app/\(auth\)/research/
ls -la "src/app/(auth)/research/[slug]/"
ls -la src/components/member/
```

All should pass without errors.
</verification>

<success_criteria>
1. Research library page shows tier-filtered reports
2. Free users see locked reports with upgrade prompt
3. Research detail page shows full content for accessible reports
4. ResearchDetailCard shows stock symbol, name, rating, target price
5. 403 errors handled gracefully with locked state UI
6. TypeScript compiles without errors
7. Build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/07-frontend-member-area/07-06-SUMMARY.md`
</output>
